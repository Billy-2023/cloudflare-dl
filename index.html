<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>40ç­å­¦ç”Ÿæˆç»©ç®¡ç†ç³»ç»Ÿ - V2.56R</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'ç­‰çº¿', 'Segoe UI', 'Microsoft YaHei', Arial, sans-serif;
        }
        
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #2196F3;
            --accent-color: #FF9800;
            --text-color: #333;
            --bg-color: #f5f5f5;
            --card-bg: #ffffff;
            --border-color: #ddd;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .dark-theme {
            --primary-color: #66BB6A;
            --secondary-color: #42A5F5;
            --accent-color: #FFA726;
            --text-color: #e0e0e0;
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --border-color: #333;
            --shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        
        body {
            background: var(--bg-color);
            padding: 20px;
            color: var(--text-color);
            overflow-x: hidden;
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 25px;
            position: relative;
            overflow: visible;
            transition: all 0.3s ease;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .class-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .class-info {
            font-size: 16px;
            color: var(--text-color);
            background: rgba(0,0,0,0.05);
            padding: 8px 15px;
            border-radius: 20px;
        }
        
        .theme-toggle {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
        }
        
        .exam-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0,0,0,0.03);
            border-radius: 8px;
        }
        
        .exam-name {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .exam-input {
            flex: 1;
            min-width: 200px;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text-color);
        }
        
        .pass-score-setting {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 10px 15px;
            background: rgba(0,0,0,0.03);
            border-radius: 8px;
        }
        
        .pass-score-label {
            font-weight: 600;
        }
        
        .pass-score-input {
            width: 60px;
            padding: 5px 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--card-bg);
            color: var(--text-color);
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 10px 15px;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .table-container {
            width: 100%;
            overflow-x: auto;
            margin-bottom: 25px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }
        
        th, td {
            border: 1px solid var(--border-color);
            padding: 12px 8px;
            text-align: center;
        }
        
        th {
            background: rgba(0,0,0,0.05);
            font-weight: 600;
            position: sticky;
            left: 0;
        }
        
        tr:nth-child(even) {
            background-color: rgba(0,0,0,0.02);
        }
        
        .student-id {
            font-weight: 600;
            background: rgba(0,0,0,0.03);
            position: sticky;
            left: 0;
        }
        
        .score {
            font-weight: bold;
            position: relative;
            min-width: 80px;
        }
        
        .highlight {
            background-color: #ffff99 !important;
            transition: background-color 0.5s;
            animation: highlightPulse 1s ease;
        }
        
        @keyframes highlightPulse {
            0% { background-color: #ffff99; }
            50% { background-color: #ffeb3b; }
            100% { background-color: #ffff99; }
        }
        
        .permanent-highlight {
            background: linear-gradient(45deg, #fff9c4, #fff59d) !important;
            box-shadow: inset 0 0 0 2px #ffd54f;
            position: relative;
            animation: glow 2s infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: inset 0 0 0 2px #ffd54f, 0 0 10px rgba(255, 213, 79, 0.5); }
            to { box-shadow: inset 0 0 0 2px #ffd54f, 0 0 20px rgba(255, 213, 79, 0.8); }
        }
        
        .not-submitted {
            color: #f44336;
            font-weight: bold;
            background: linear-gradient(45deg, #ffcdd2, #ffebee);
            border-radius: 4px;
            animation: pulse 1.5s infinite;
            position: relative;
        }
        
        .not-submitted::after {
            content: "âŒâŒ";
            margin-left: 5px;
            animation: spin 1s infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .pass {
            color: #4CAF50;
        }
        
        .fail {
            color: #F44336;
        }
        
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            box-shadow: var(--shadow);
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }
        
        .chart-container {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }
        
        .chart-title {
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .chart {
            height: 200px;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            padding: 0 10px;
        }
        
        .chart-bar {
            width: 40px;
            background: var(--primary-color);
            border-radius: 4px 4px 0 0;
            position: relative;
            transition: height 0.5s ease;
        }
        
        .chart-bar-label {
            position: absolute;
            bottom: -25px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 12px;
        }
        
        .chart-bar-value {
            position: absolute;
            top: -20px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .input-section {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }
        
        .input-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        #scoreInput {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text-color);
        }
        
        #addScore {
            padding: 12px 25px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .batch-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .batch-input {
            flex: 1;
            min-width: 200px;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text-color);
        }
        
        .batch-btn {
            padding: 10px 15px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .instructions {
            margin-top: 10px;
            font-size: 14px;
            color: var(--text-color);
        }
        
        .examples {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .example {
            background: rgba(0,0,0,0.05);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow);
        }
        
        .modal-title {
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-secondary {
            background: var(--border-color);
            color: var(--text-color);
        }
        
        .backup-notice {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--accent-color);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            box-shadow: var(--shadow);
            display: none;
            z-index: 100;
        }
        
        .ranking-container {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            display: none;
        }
        
        .ranking-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
            color: var(--primary-color);
        }
        
        .ranking-info {
            text-align: center;
            margin-bottom: 15px;
            color: var(--text-color);
        }
        
        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .ranking-table th {
            background: var(--primary-color);
            color: white;
            padding: 12px 8px;
            text-align: center;
            position: sticky;
            top: 0;
        }
        
        .ranking-table td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }
        
        .ranking-table tr:nth-child(even) {
            background: rgba(0,0,0,0.03);
        }
        
        .ranking-table tr:hover {
            background: rgba(0,0,0,0.05);
        }
        
        .ranking-rank {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .ranking-score {
            font-weight: bold;
        }
        
        .same-rank {
            background: rgba(76, 175, 80, 0.1) !important;
        }
        
        .medal-gold {
            color: #FFD700;
            font-weight: bold;
        }
        
        .medal-silver {
            color: #C0C0C0;
            font-weight: bold;
        }
        
        .medal-bronze {
            color: #CD7F32;
            font-weight: bold;
        }
        
        .close-ranking {
            display: block;
            margin: 20px auto 0;
            padding: 8px 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        /* ä½¿ç”¨è¯´æ˜æ ·å¼ */
        .user-manual {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: var(--shadow);
            font-family: 'ä»¿å®‹', 'FangSong', serif;
            line-height: 1.8;
        }
        
        .manual-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
        }
        
        .manual-section {
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 10px;
            border-left: 4px solid var(--accent-color);
            padding-left: 10px;
        }
        
        .manual-content {
            font-size: 16px;
            text-align: justify;
            margin-bottom: 15px;
        }
        
        .manual-list {
            padding-left: 25px;
            margin-bottom: 15px;
        }
        
        .manual-list li {
            margin-bottom: 8px;
        }
        
        .manual-note {
            background: rgba(255, 152, 0, 0.1);
            border-left: 4px solid var(--accent-color);
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .class-title {
                font-size: 24px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .input-container {
                flex-direction: column;
            }
            
            .batch-actions {
                flex-direction: column;
            }
            
            .stats-panel {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .user-manual {
                padding: 15px;
            }
            
            .manual-title {
                font-size: 20px;
            }
            
            .section-title {
                font-size: 18px;
            }
            
            .manual-content {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <div class="class-title">40ç­å­¦ç”Ÿæˆç»©ç®¡ç†ç³»ç»Ÿ</div>
                <div class="class-info">å…±51åå­¦ç”Ÿ</div>
            </div>
            <button class="theme-toggle" id="themeToggle">ğŸŒ™ğŸŒ™ æš—è‰²æ¨¡å¼</button>
        </div>
        
        <div class="exam-info">
            <span class="exam-name" id="examNameDisplay">æœªå‘½åè€ƒè¯•</span>
            <input type="text" class="exam-input" id="examNameInput" placeholder="è¾“å…¥è€ƒè¯•åç§°ï¼Œå¦‚ï¼šæœŸä¸­è€ƒè¯•ã€å•å…ƒæµ‹è¯•ç­‰">
            <button class="batch-btn" id="saveExamName">ä¿å­˜è€ƒè¯•åç§°</button>
        </div>
        
        <div class="pass-score-setting">
            <span class="pass-score-label">åŠæ ¼åˆ†æ•°è®¾ç½®ï¼š</span>
            <input type="number" class="pass-score-input" id="passScoreInput" min="0" max="150" value="60">
            <span>åˆ†</span>
            <button class="batch-btn" id="savePassScore">ä¿å­˜è®¾ç½®</button>
        </div>
        
        <div class="controls">
            <button class="control-btn" id="showStats">ğŸ“ŠğŸ“Š æˆç»©ç»Ÿè®¡</button>
            <button class="control-btn" id="showChart">ğŸ“ˆğŸ“ˆ æˆç»©åˆ†å¸ƒ</button>
            <button class="control-btn" id="showRankingBtn">ğŸ†ğŸ† æˆç»©æ’è¡Œæ¦œ</button>
            <button class="control-btn" id="exportData">ğŸ’¾ğŸ’¾ å¯¼å‡ºJSON</button>
            <button class="control-btn" id="importData">ğŸ“¤ğŸ“¤ å¯¼å…¥æ•°æ®</button>
            <button class="control-btn" id="toggleSpeech">ğŸ”ŠğŸ”Š å…³é—­æœ—è¯»</button>
        </div>
        
        <div class="stats-panel" id="statsPanel" style="display: none;">
            <div class="stat-card">
                <div>å¹³å‡åˆ†</div>
                <div class="stat-value" id="avgScore">0</div>
                <div>å…¨ç­å¹³å‡æˆç»©</div>
            </div>
            <div class="stat-card">
                <div>æœ€é«˜åˆ†</div>
                <div class="stat-value" id="maxScore">0</div>
                <div>ç­çº§æœ€é«˜æˆç»©</div>
            </div>
            <div class="stat-card">
                <div>æœ€ä½åˆ†</div>
                <div class="stat-value" id="minScore">0</div>
                <div>ç­çº§æœ€ä½æˆç»©</div>
            </div>
            <div class="stat-card">
                <div>åŠæ ¼ç‡</div>
                <div class="stat-value" id="passRate">0%</div>
                <div id="passRateDesc">60åˆ†ä»¥ä¸Šæ¯”ä¾‹</div>
            </div>
        </div>
        
        <div class="chart-container" id="chartContainer" style="display: none;">
            <div class="chart-title">æˆç»©åˆ†å¸ƒå›¾</div>
            <div class="chart" id="scoreChart">
                <!-- å›¾è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="ranking-container" id="rankingContainer">
            <div class="ranking-title">ğŸ¯ğŸ¯ æˆç»©æ’è¡Œæ¦œ - <span id="rankingExamName">æœªå‘½åè€ƒè¯•</span></div>
            <div class="ranking-info" id="rankingInfo">å…± <span id="rankingCount">0</span> åå­¦ç”Ÿæœ‰æˆç»©</div>
            <table class="ranking-table">
                <thead>
                    <tr>
                        <th>åæ¬¡</th>
                        <th>å§“å</th>
                        <th>å­¦å·</th>
                        <th>åˆ†æ•°</th>
                        <th>çŠ¶æ€</th>
                    </tr>
                </thead>
                <tbody id="rankingBody">
                    <!-- æ’è¡Œæ¦œå†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </tbody>
            </table>
            <button class="close-ranking" id="closeRanking">éšè—æ’è¡Œæ¦œ</button>
        </div>
        
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>å§“å</th>
                        <th>å­¦å·</th>
                        <th>æˆç»©</th>
                        <th>å§“å</th>
                        <th>å­¦å·</th>
                        <th>æˆç»©</th>
                        <th>å§“å</th>
                        <th>å­¦å·</th>
                        <th>æˆç»©</th>
                    </tr>
                </thead>
                <tbody id="scoreTable">
                    <!-- è¡¨æ ¼å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </tbody>
            </table>
        </div>
        
        <div class="input-section">
            <div class="input-title">æˆç»©å½•å…¥</div>
            <div class="input-container">
                <input type="text" id="scoreInput" placeholder="è¾“å…¥æ ¼å¼ï¼šå­¦å·+åˆ†æ•°ï¼Œå¦‚ï¼š0170 æˆ– 34100 æˆ– 587.5">
                <button id="addScore">å½•å…¥æˆç»©</button>
            </div>
            
            <div class="batch-actions">
                <input type="text" class="batch-input" id="batchScores" placeholder="æ‰¹é‡è¾“å…¥ï¼šå­¦å·:åˆ†æ•°ï¼Œç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼š1:85,2:90,3:77.5">
                <button class="batch-btn" id="batchAdd">æ‰¹é‡å½•å…¥</button>
                <input type="text" class="batch-input" id="highlightStudents" placeholder="æ‰¹é‡é«˜äº®å­¦å·ï¼Œç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼š1,5,10,15">
                <button class="batch-btn" id="batchHighlight">æ‰¹é‡æ°¸ä¹…é«˜äº®</button>
                <button class="batch-btn" id="clearHighlights">æ¸…é™¤é«˜äº®</button>
            </div>
            
            <div class="instructions">
                <p>è¾“å…¥è¯´æ˜ï¼š</p>
                <div class="examples">
                    <div class="example">0170 â†’ 1å·å¾—70åˆ†</div>
                    <div class="example">34100 â†’ 34å·å¾—100åˆ†</div>
                    <div class="example">587.5 â†’ 5å·å¾—87.5åˆ†</div>
                    <div class="example">NO 12 â†’ 12å·å­¦ç”Ÿæ ‡è®°ä¸ºæœªäº¤(X)</div>
                    <div class="example">pb â†’ æ˜¾ç¤ºæˆç»©æ’è¡Œæ¦œ</div>
                    <div class="example">color 5 â†’ 5å·å­¦ç”Ÿæ°¸ä¹…é«˜äº®</div>
                </div>
                <p style="margin-top: 10px;">æ”¯æŒæ‰¹é‡è¾“å…¥ï¼Œç”¨ç©ºæ ¼æˆ–é€—å·åˆ†éš”ï¼š<strong>0170 34100 587.5</strong></p>
            </div>
        </div>
        
        <!-- ä½¿ç”¨è¯´æ˜éƒ¨åˆ† -->
        <div class="user-manual">
            <div class="manual-title">ğŸ“š 40ç­å­¦ç”Ÿæˆç»©ç®¡ç†ç³»ç»Ÿä½¿ç”¨è¯´æ˜</div>
            
            <div class="manual-section">
                <div class="section-title">ä¸€ã€ç³»ç»Ÿæ¦‚è¿°</div>
                <div class="manual-content">
                    æœ¬ç³»ç»Ÿä¸“ä¸º40ç­å­¦ç”Ÿæˆç»©ç®¡ç†è€Œè®¾è®¡ï¼Œæ”¯æŒ51åå­¦ç”Ÿçš„æˆç»©å½•å…¥ã€ç»Ÿè®¡ã€åˆ†æå’Œå¯è§†åŒ–åŠŸèƒ½ã€‚ç³»ç»Ÿé‡‡ç”¨æœ¬åœ°å­˜å‚¨æŠ€æœ¯ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ï¼ŒåŒæ—¶æä¾›ä¾¿æ·çš„æ“ä½œç•Œé¢å’Œä¸°å¯Œçš„åŠŸèƒ½é€‰é¡¹ï¼Œæ»¡è¶³æ—¥å¸¸æ•™å­¦ç®¡ç†éœ€æ±‚ã€‚
                </div>
            </div>
            
            <div class="manual-section">
                <div class="section-title">äºŒã€åŸºæœ¬æ“ä½œæŒ‡å—</div>
                <div class="manual-content">
                    <strong>1. è€ƒè¯•åç§°è®¾ç½®</strong><br>
                    åœ¨"è€ƒè¯•åç§°"è¾“å…¥æ¡†ä¸­è¾“å…¥æœ¬æ¬¡è€ƒè¯•çš„åç§°ï¼ˆå¦‚ï¼šæœŸä¸­è€ƒè¯•ã€å•å…ƒæµ‹è¯•ç­‰ï¼‰ï¼Œç‚¹å‡»"ä¿å­˜è€ƒè¯•åç§°"æŒ‰é’®å³å¯ä¿å­˜ã€‚
                </div>
                <div class="manual-content">
                    <strong>2. åŠæ ¼åˆ†æ•°è®¾ç½®</strong><br>
                    åœ¨"åŠæ ¼åˆ†æ•°è®¾ç½®"åŒºåŸŸè¾“å…¥åŠæ ¼åˆ†æ•°çº¿ï¼ˆ0-150åˆ†ï¼‰ï¼Œç‚¹å‡»"ä¿å­˜è®¾ç½®"æŒ‰é’®å³å¯ç”Ÿæ•ˆã€‚ç³»ç»Ÿå°†æ ¹æ®æ­¤åˆ†æ•°è‡ªåŠ¨åˆ¤æ–­å­¦ç”Ÿæˆç»©æ˜¯å¦åŠæ ¼ã€‚
                </div>
                <div class="manual-content">
                    <strong>3. å•ä¸ªæˆç»©å½•å…¥</strong><br>
                    åœ¨"æˆç»©å½•å…¥"åŒºåŸŸçš„è¾“å…¥æ¡†ä¸­ï¼ŒæŒ‰ç…§"å­¦å·+åˆ†æ•°"çš„æ ¼å¼è¾“å…¥ï¼Œä¾‹å¦‚ï¼š
                    <ul class="manual-list">
                        <li><strong>0170</strong> â†’ 1å·å­¦ç”Ÿå¾—70åˆ†</li>
                        <li><strong>34100</strong> â†’ 34å·å­¦ç”Ÿå¾—100åˆ†</li>
                        <li><strong>587.5</strong> â†’ 5å·å­¦ç”Ÿå¾—87.5åˆ†</li>
                    </ul>
                    è¾“å…¥å®Œæˆåç‚¹å‡»"å½•å…¥æˆç»©"æŒ‰é’®æˆ–æŒ‰Enteré”®ç¡®è®¤ã€‚
                </div>
                <div class="manual-content">
                    <strong>4. æ‰¹é‡æˆç»©å½•å…¥</strong><br>
                    åœ¨"æ‰¹é‡è¾“å…¥"æ¡†ä¸­ï¼ŒæŒ‰ç…§"å­¦å·:åˆ†æ•°"çš„æ ¼å¼è¾“å…¥å¤šä¸ªæˆç»©ï¼Œç”¨é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š<strong>1:85,2:90,3:77.5</strong>ï¼Œç„¶åç‚¹å‡»"æ‰¹é‡å½•å…¥"æŒ‰é’®ã€‚
                </div>
                <div class="manual-content">
                    <strong>5. ç‰¹æ®ŠåŠŸèƒ½å‘½ä»¤</strong><br>
                    åœ¨æˆç»©å½•å…¥æ¡†ä¸­è¾“å…¥ä»¥ä¸‹ç‰¹æ®Šå‘½ä»¤å¯å®ç°ç›¸åº”åŠŸèƒ½ï¼š
                    <ul class="manual-list">
                        <li><strong>NO å­¦å·</strong> â†’ æ ‡è®°è¯¥å­¦ç”Ÿæœªäº¤å·ï¼ˆå¦‚ï¼šNO 12ï¼‰</li>
                        <li><strong>color å­¦å·</strong> â†’ ä¸ºè¯¥å­¦ç”Ÿè®¾ç½®æ°¸ä¹…é«˜äº®ï¼ˆå¦‚ï¼šcolor 5ï¼‰</li>
                        <li><strong>dcolor å­¦å·</strong> â†’ å–æ¶ˆè¯¥å­¦ç”Ÿçš„æ°¸ä¹…é«˜äº®</li>
                        <li><strong>pb</strong> â†’ æ˜¾ç¤ºæˆç»©æ’è¡Œæ¦œ</li>
                        <li><strong>clear</strong> â†’ æ¸…ç©ºæ‰€æœ‰æˆç»©ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰</li>
                    </ul>
                </div>
            </div>
            
            <div class="manual-section">
                <div class="section-title">ä¸‰ã€æ•°æ®ç»Ÿè®¡ä¸åˆ†æ</div>
                <div class="manual-content">
                    <strong>1. æˆç»©ç»Ÿè®¡</strong><br>
                    ç‚¹å‡»"æˆç»©ç»Ÿè®¡"æŒ‰é’®ï¼Œç³»ç»Ÿå°†æ˜¾ç¤ºæœ¬æ¬¡è€ƒè¯•çš„å¹³å‡åˆ†ã€æœ€é«˜åˆ†ã€æœ€ä½åˆ†å’ŒåŠæ ¼ç‡ç­‰å…³é”®ç»Ÿè®¡æ•°æ®ã€‚
                </div>
                <div class="manual-content">
                    <strong>2. æˆç»©åˆ†å¸ƒå›¾</strong><br>
                    ç‚¹å‡»"æˆç»©åˆ†å¸ƒ"æŒ‰é’®ï¼Œç³»ç»Ÿå°†ç”Ÿæˆæˆç»©åˆ†å¸ƒæŸ±çŠ¶å›¾ï¼Œç›´è§‚å±•ç¤ºå„åˆ†æ•°æ®µçš„å­¦ç”Ÿäººæ•°åˆ†å¸ƒæƒ…å†µã€‚
                </div>
                <div class="manual-content">
                    <strong>3. æˆç»©æ’è¡Œæ¦œ</strong><br>
                    ç‚¹å‡»"æˆç»©æ’è¡Œæ¦œ"æŒ‰é’®æˆ–åœ¨æˆç»©å½•å…¥æ¡†ä¸­è¾“å…¥"pb"å‘½ä»¤ï¼Œç³»ç»Ÿå°†æ˜¾ç¤ºå­¦ç”Ÿæˆç»©æ’åï¼Œå‰ä¸‰åå°†è·å¾—é‡‘ã€é“¶ã€é“œç‰Œæ ‡è¯†ã€‚
                </div>
            </div>
            
            <div class="manual-section">
                <div class="section-title">å››ã€æ•°æ®ç®¡ç†åŠŸèƒ½</div>
                <div class="manual-content">
                    <strong>1. æ•°æ®å¯¼å‡º</strong><br>
                    ç‚¹å‡»"å¯¼å‡ºJSON"æŒ‰é’®ï¼Œç³»ç»Ÿå°†å½“å‰æ‰€æœ‰æ•°æ®ï¼ˆåŒ…æ‹¬æˆç»©ã€è€ƒè¯•åç§°ã€åŠæ ¼åˆ†æ•°ç­‰ï¼‰å¯¼å‡ºä¸ºJSONæ ¼å¼æ–‡ä»¶ï¼Œä¾¿äºå¤‡ä»½æˆ–è¿ç§»ã€‚
                </div>
                <div class="manual-content">
                    <strong>2. æ•°æ®å¯¼å…¥</strong><br>
                    ç‚¹å‡»"å¯¼å…¥æ•°æ®"æŒ‰é’®ï¼Œé€‰æ‹©ä¹‹å‰å¯¼å‡ºçš„JSONæ–‡ä»¶ï¼Œç³»ç»Ÿå°†æ¢å¤æ‰€æœ‰æ•°æ®è®¾ç½®ã€‚
                </div>
                <div class="manual-content">
                    <strong>3. æ°¸ä¹…é«˜äº®ç®¡ç†</strong><br>
                    åœ¨"æ‰¹é‡é«˜äº®å­¦å·"æ¡†ä¸­è¾“å…¥å­¦å·ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ï¼Œç‚¹å‡»"æ‰¹é‡æ°¸ä¹…é«˜äº®"å¯ä¸ºå¤šä¸ªå­¦ç”Ÿè®¾ç½®æ°¸ä¹…é«˜äº®ï¼›ç‚¹å‡»"æ¸…é™¤é«˜äº®"å¯æ¸…é™¤æ‰€æœ‰æ°¸ä¹…é«˜äº®è®¾ç½®ã€‚
                </div>
            </div>
            
            <div class="manual-section">
                <div class="section-title">äº”ã€ä¸ªæ€§åŒ–è®¾ç½®</div>
                <div class="manual-content">
                    <strong>1. ä¸»é¢˜åˆ‡æ¢</strong><br>
                    ç‚¹å‡»å³ä¸Šè§’çš„"æš—è‰²æ¨¡å¼/äº®è‰²æ¨¡å¼"æŒ‰é’®ï¼Œå¯åœ¨æ·±è‰²å’Œæµ…è‰²ä¸»é¢˜ä¹‹é—´åˆ‡æ¢ï¼Œé€‚åº”ä¸åŒå…‰çº¿ç¯å¢ƒã€‚
                </div>
                <div class="manual-content">
                    <strong>2. è¯­éŸ³æœ—è¯»</strong><br>
                    ç³»ç»Ÿé»˜è®¤å¼€å¯è¯­éŸ³æœ—è¯»åŠŸèƒ½ï¼Œæ¯æ¬¡å½•å…¥æˆç»©æ—¶ä¼šæœ—è¯»å­¦ç”Ÿå§“åå’Œåˆ†æ•°ã€‚ç‚¹å‡»"å…³é—­æœ—è¯»"æŒ‰é’®å¯å…³é—­æ­¤åŠŸèƒ½ï¼Œå†æ¬¡ç‚¹å‡»å¯é‡æ–°å¼€å¯ã€‚
                </div>
            </div>
            
            <div class="manual-section">
                <div class="section-title">å…­ã€æ³¨æ„äº‹é¡¹</div>
                <div class="manual-content">
                    <ul class="manual-list">
                        <li>ç³»ç»Ÿä½¿ç”¨æµè§ˆå™¨æœ¬åœ°å­˜å‚¨æŠ€æœ¯ï¼Œæ•°æ®ä¿å­˜åœ¨å½“å‰è®¾å¤‡ä¸­ï¼Œè¯·å®šæœŸä½¿ç”¨"å¯¼å‡ºJSON"åŠŸèƒ½å¤‡ä»½æ•°æ®ã€‚</li>
                        <li>æ¸…ç©ºæµè§ˆå™¨ç¼“å­˜å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œè¯·åŠ¡å¿…æå‰å¤‡ä»½é‡è¦æ•°æ®ã€‚</li>
                        <li>ç³»ç»Ÿæ”¯æŒ0-150åˆ†çš„æˆç»©å½•å…¥ï¼Œæ”¯æŒå°æ•°ï¼ˆå¦‚87.5ï¼‰ã€‚</li>
                        <li>æ ‡è®°ä¸º"æœªäº¤"çš„å­¦ç”Ÿæˆç»©å°†ä¸è®¡å…¥ç»Ÿè®¡å’Œæ’åã€‚</li>
                        <li>ç³»ç»Ÿæ¯5åˆ†é’Ÿä¼šæ˜¾ç¤ºå¤‡ä»½æé†’ï¼Œå»ºè®®åŠæ—¶å¤‡ä»½æ•°æ®ã€‚</li>
                        <li>åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šä½¿ç”¨æ—¶ï¼Œéƒ¨åˆ†ç•Œé¢å¸ƒå±€ä¼šè‡ªé€‚åº”è°ƒæ•´ï¼Œç¡®ä¿æœ€ä½³æ˜¾ç¤ºæ•ˆæœã€‚</li>
                    </ul>
                </div>
            </div>
            
            <div class="manual-note">
                ğŸ’¡ <strong>æç¤ºï¼š</strong> æœ¬ç³»ç»Ÿå®Œå…¨åœ¨æµè§ˆå™¨ç«¯è¿è¡Œï¼Œæ— éœ€ç½‘ç»œè¿æ¥å³å¯ä½¿ç”¨ã€‚æ‰€æœ‰æ•°æ®å‡ä¿å­˜åœ¨æœ¬åœ°ï¼Œç¡®ä¿éšç§å®‰å…¨ã€‚å»ºè®®åœ¨ä½¿ç”¨å‰å…ˆè®¾ç½®è€ƒè¯•åç§°å’ŒåŠæ ¼åˆ†æ•°ï¼Œå†è¿›è¡Œæˆç»©å½•å…¥æ“ä½œã€‚
            </div>
        </div>
    </div>
    
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-title">å¯¼å…¥æ•°æ®</div>
            <p>è¯·é€‰æ‹©è¦å¯¼å…¥çš„æ•°æ®æ–‡ä»¶ï¼ˆJSONæ ¼å¼ï¼‰ï¼š</p>
            <input type="file" id="fileInput" accept=".json" style="margin: 15px 0; width: 100%;">
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelImport">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="confirmImport">å¯¼å…¥</button>
            </div>
        </div>
    </div>
    
    <div class="backup-notice" id="backupNotice">
        ğŸ’¡ğŸ’¡ è®°å¾—å®šæœŸå¤‡ä»½æ‚¨çš„æ•°æ®ï¼
    </div>

    <script>
        // å­¦ç”Ÿæ•°æ®
        const studentData = {
            1: { name: "é«˜ç‘è¾°" },
            2: { name: "æ²ˆå­¦å¢" },
            3: { name: "é­ç‘€å½¤" },
            4: { name: "é«˜é“å¿ƒ" },
            5: { name: "ç‹éº’ç¡•" },
            6: { name: "å»‰é¸¿æ•¬æ¥ " },
            7: { name: "åˆ˜å˜‰é”Œ" },
            8: { name: "å†·ç¥¥èµ«" },
            9: { name: "å¼ å¿µç«¹" },
            10: { name: "æå­å¢¨" },
            11: { name: "å­™æ™¨ç‘" },
            12: { name: "éƒ‘é›…å…®" },
            13: { name: "å‘¨ç¦¹è¾°" },
            14: { name: "é™†ç›ˆå¿ƒ" },
            15: { name: "å•é‡‘æ´‹" },
            16: { name: "å¼ åœ£è‰º" },
            17: { name: "æ¢è·æ¬£" },
            18: { name: "ç‰é’¶å‡¡" },
            19: { name: "å´ä¸œæ™“" },
            20: { name: "åˆ˜éŸµéº’" },
            21: { name: "éƒ­æ˜Ÿä¹" },
            22: { name: "å¼ çš“åš" },
            23: { name: "ç‹æ˜±ç³" },
            24: { name: "å­™è‹¥å‡º" },
            25: { name: "æ–¹åœ£åš" },
            26: { name: "åˆ˜å“²å®‡" },
            27: { name: "ç‹æ¥šè¡" },
            28: { name: "é‚¢éŸµ" },
            29: { name: "éƒ‘çš“" },
            30: { name: "è´¾å¾¡æ•¬ä½³" },
            31: { name: "ç™½æ¢“è¾°" },
            32: { name: "ç‹æ€æ¶µ" },
            33: { name: "é­ç¥è¾°" },
            34: { name: "é«˜æºä½œ" },
            35: { name: "å­™é™æ±" },
            36: { name: "åˆ˜æ˜ å¸Œ" },
            37: { name: "èµµæµ©æ·³" },
            38: { name: "ä½•å“é˜³" },
            39: { name: "æ¨é›ªåŸ" },
            40: { name: "éƒ‘å²šæ›¦" },
            41: { name: "è·¯æ ©éª„" },
            42: { name: "å†¯å¤©è¶Š" },
            43: { name: "è¾›æ²éœ–" },
            44: { name: "éŸ©ç¿˜å±¹" },
            45: { name: "å´ä½³ç¾æ±" },
            46: { name: "é«˜ç•…" },
            47: { name: "é»„å­æ´µ" },
            48: { name: "åˆ˜æ½†ç¦§" },
            49: { name: "ç‹æ€åšã€ç”·Aã€‘" },
            50: { name: "ç‹æ€åšã€å¥³Bã€‘" },
            51: { name: "ç‹éŸ¦æ¶µ" }
        };

        // å…¨å±€å˜é‡
        let scores = {};
        let isDarkTheme = false;
        let passScore = 60;
        let examName = "æœªå‘½åè€ƒè¯•";
        let permanentHighlights = {};
        let isSpeechEnabled = true;
        let speechQueue = [];
        let isSpeaking = false;

        document.addEventListener('DOMContentLoaded', function() {
            initializeTable();
            loadFromLocalStorage();
            updateStats();
            bindEvents();
            setInterval(showBackupNotice, 5 * 60 * 1000);
        });
        
        function initializeTable() {
            const tableBody = document.getElementById('scoreTable');
            tableBody.innerHTML = '';
            
            for (let i = 1; i <= 51; i += 3) {
                const row = document.createElement('tr');
                
                for (let j = 0; j < 3; j++) {
                    const studentId = i + j;
                    if (studentId > 51) {
                        for (let k = j; k < 3; k++) {
                            const emptyCell1 = document.createElement('td');
                            const emptyCell2 = document.createElement('td');
                            const emptyCell3 = document.createElement('td');
                            row.appendChild(emptyCell1);
                            row.appendChild(emptyCell2);
                            row.appendChild(emptyCell3);
                        }
                        break;
                    }
                    
                    const student = studentData[studentId];
                    
                    const nameCell = document.createElement('td');
                    nameCell.textContent = student.name;
                    
                    const idCell = document.createElement('td');
                    idCell.textContent = studentId;
                    
                    const scoreCell = document.createElement('td');
                    scoreCell.className = 'score';
                    scoreCell.setAttribute('data-id', studentId);
                    const score = scores[studentId] || '';
                    scoreCell.textContent = score;
                    
                    if (score !== '' && score !== 'X') {
                        const scoreValue = parseFloat(score);
                        if (!isNaN(scoreValue)) {
                            scoreCell.classList.add(scoreValue >= passScore ? 'pass' : 'fail');
                        }
                    } else if (score === 'X') {
                        scoreCell.classList.add('not-submitted');
                    }
                    
                    if (permanentHighlights[studentId]) {
                        scoreCell.classList.add('permanent-highlight');
                    }
                    
                    row.appendChild(nameCell);
                    row.appendChild(idCell);
                    row.appendChild(scoreCell);
                }
                
                tableBody.appendChild(row);
            }
        }
        
        function bindEvents() {
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            document.getElementById('saveExamName').addEventListener('click', saveExamName);
            document.getElementById('examNameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') saveExamName();
            });
            document.getElementById('savePassScore').addEventListener('click', savePassScore);
            document.getElementById('passScoreInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') savePassScore();
            });
            document.getElementById('addScore').addEventListener('click', addScore);
            document.getElementById('scoreInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addScore();
            });
            document.getElementById('batchAdd').addEventListener('click', batchAddScores);
            document.getElementById('batchHighlight').addEventListener('click', batchPermanentHighlight);
            document.getElementById('clearHighlights').addEventListener('click', clearPermanentHighlights);
            document.getElementById('exportData').addEventListener('click', exportData);
            document.getElementById('importData').addEventListener('click', showImportModal);
            document.getElementById('showStats').addEventListener('click', toggleStats);
            document.getElementById('showChart').addEventListener('click', toggleChart);
            document.getElementById('showRankingBtn').addEventListener('click', toggleRanking);
            document.getElementById('closeRanking').addEventListener('click', function() {
                document.getElementById('rankingContainer').style.display = 'none';
            });
            document.getElementById('cancelImport').addEventListener('click', hideImportModal);
            document.getElementById('confirmImport').addEventListener('click', importData);
            document.getElementById('backupNotice').addEventListener('click', function() {
                this.style.display = 'none';
            });
            document.getElementById('toggleSpeech').addEventListener('click', toggleSpeech);
        }
        
        function saveExamName() {
            const newExamName = document.getElementById('examNameInput').value.trim();
            if (newExamName) {
                examName = newExamName;
                document.getElementById('examNameDisplay').textContent = examName;
                document.getElementById('examNameInput').value = '';
                saveToLocalStorage();
                alert(`è€ƒè¯•åç§°å·²è®¾ç½®ä¸ºï¼š${examName}`);
            } else {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„è€ƒè¯•åç§°');
            }
        }
        
        function savePassScore() {
            const newPassScore = parseInt(document.getElementById('passScoreInput').value);
            
            if (isNaN(newPassScore) || newPassScore < 0 || newPassScore > 150) {
                alert('è¯·è¾“å…¥0-150ä¹‹é—´çš„æœ‰æ•ˆåˆ†æ•°ï¼');
                return;
            }
            
            passScore = newPassScore;
            updatePassScoreDisplay();
            updateStats();
            initializeTable();
            saveToLocalStorage();
            alert(`åŠæ ¼åˆ†æ•°å·²è®¾ç½®ä¸º ${passScore} åˆ†`);
        }
        
        function updatePassScoreDisplay() {
            document.getElementById('passRateDesc').textContent = `${passScore}åˆ†ä»¥ä¸Šæ¯”ä¾‹`;
        }
        
        function addScore() {
            const input = document.getElementById('scoreInput').value.trim();
            if (!input) return;
            
            if (input.toLowerCase() === 'clear') {
                clearAllScores();
                document.getElementById('scoreInput').value = '';
                return;
            }
            
            if (input.toLowerCase() === 'pb') {
                toggleRanking();
                document.getElementById('scoreInput').value = '';
                return;
            }
            
            if (input.toUpperCase().startsWith('NO ')) {
                const studentId = parseInt(input.substring(3));
                markAsNotSubmitted(studentId);
                document.getElementById('scoreInput').value = '';
                return;
            }
            
            if (input.toLowerCase().startsWith('color ')) {
                const studentId = parseInt(input.substring(6));
                togglePermanentHighlight(studentId);
                document.getElementById('scoreInput').value = '';
                return;
            }
            
            if (input.toLowerCase().startsWith('dcolor ')) {
                const studentId = parseInt(input.substring(7));
                removePermanentHighlight(studentId);
                document.getElementById('scoreInput').value = '';
                return;
            }
            
            const entries = input.split(/[\s,]+/);
            
            entries.forEach(entry => {
                if (!entry) return;
                
                let studentId, score;
                
                if (entry.length <= 2) {
                    studentId = getNextEmptyStudent();
                    score = parseFloat(entry);
                } else {
                    let idStr = '';
                    let scoreStr = '';
                    
                    for (let i = 0; i < entry.length; i++) {
                        if (!isNaN(parseInt(entry[i])) || entry[i] === '.') {
                            idStr += entry[i];
                        } else {
                            scoreStr = entry.substring(i);
                            break;
                        }
                    }
                    
                    if (!scoreStr) {
                        if (entry.length > 2) {
                            const possibleId = parseInt(entry.substring(0, 2));
                            if (possibleId >= 1 && possibleId <= 51) {
                                studentId = possibleId;
                                score = parseFloat(entry.substring(2));
                            } else {
                                studentId = parseInt(entry.substring(0, 1));
                                score = parseFloat(entry.substring(1));
                            }
                        } else {
                            studentId = parseInt(entry.substring(0, 1));
                            score = parseFloat(entry.substring(1));
                        }
                    } else {
                        studentId = parseInt(idStr);
                        score = parseFloat(scoreStr);
                    }
                }
                
                if (isNaN(studentId) || studentId < 1 || studentId > 51) {
                    alert(`æ— æ•ˆçš„å­¦å·: ${studentId}ã€‚å­¦å·åº”ä¸º1-51ä¹‹é—´çš„æ•°å­—ã€‚`);
                    return;
                }
                
                if (isNaN(score) || score < 0 || score > 150) {
                    alert(`æ— æ•ˆçš„åˆ†æ•°: ${score}ã€‚åˆ†æ•°åº”ä¸º0-150ä¹‹é—´çš„æ•°å­—ã€‚`);
                    return;
                }
                
                updateScore(studentId, score);
                if (isSpeechEnabled) {
                    const studentName = studentData[studentId].name;
                    addToSpeechQueue(`${studentName} ${score}åˆ†`);
                }
            });
            
            document.getElementById('scoreInput').value = '';
            document.getElementById('scoreInput').focus();
            updateStats();
            updateChart();
            saveToLocalStorage();
        }
        
        function addToSpeechQueue(text) {
            speechQueue.push(text);
            if (!isSpeaking) {
                processSpeechQueue();
            }
        }
        
        function processSpeechQueue() {
            if (speechQueue.length === 0) {
                isSpeaking = false;
                return;
            }
            
            isSpeaking = true;
            const text = speechQueue.shift();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'zh-CN';
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            
            utterance.onend = function() {
                setTimeout(processSpeechQueue, 500); // æ·»åŠ 500msé—´éš”
            };
            
            window.speechSynthesis.speak(utterance);
        }
        
        function toggleSpeech() {
            isSpeechEnabled = !isSpeechEnabled;
            const btn = document.getElementById('toggleSpeech');
            btn.textContent = isSpeechEnabled ? 'ğŸ”ŠğŸ”Š å…³é—­æœ—è¯»' : 'ğŸ”ˆğŸ”ˆ å¼€å¯æœ—è¯»';
            saveToLocalStorage();
        }
        
        function markAsNotSubmitted(studentId) {
            if (isNaN(studentId) || studentId < 1 || studentId > 51) {
                alert(`æ— æ•ˆçš„å­¦å·: ${studentId}ã€‚å­¦å·åº”ä¸º1-51ä¹‹é—´çš„æ•°å­—ã€‚`);
                return;
            }
            
            const scoreCell = document.querySelector(`.score[data-id="${studentId}"]`);
            if (scoreCell) {
                scoreCell.textContent = 'X';
                scoreCell.classList.add('not-submitted');
                scoreCell.classList.remove('pass', 'fail');
                
                scoreCell.classList.add('highlight');
                setTimeout(() => {
                    scoreCell.classList.remove('highlight');
                }, 1000);
                
                scores[studentId] = 'X';
                saveToLocalStorage();
                alert(`${studentId}å·å­¦ç”Ÿå·²æ ‡è®°ä¸ºæœªäº¤`);
            }
        }
        
        function togglePermanentHighlight(studentId) {
            if (isNaN(studentId) || studentId < 1 || studentId > 51) {
                alert(`æ— æ•ˆçš„å­¦å·: ${studentId}ã€‚å­¦å·åº”ä¸º1-51ä¹‹é—´çš„æ•°å­—ã€‚`);
                return;
            }
            
            const scoreCell = document.querySelector(`.score[data-id="${studentId}"]`);
            if (scoreCell) {
                if (permanentHighlights[studentId]) {
                    scoreCell.classList.remove('permanent-highlight');
                    permanentHighlights[studentId] = false;
                    alert(`å·²å–æ¶ˆ ${studentId} å·å­¦ç”Ÿçš„æ°¸ä¹…é«˜äº®`);
                } else {
                    scoreCell.classList.add('permanent-highlight');
                    permanentHighlights[studentId] = true;
                    alert(`å·²æ°¸ä¹…é«˜äº® ${studentId} å·å­¦ç”Ÿ`);
                }
                saveToLocalStorage();
            }
        }
        
        function removePermanentHighlight(studentId) {
            if (isNaN(studentId) || studentId < 1 || studentId > 51) {
                alert(`æ— æ•ˆçš„å­¦å·: ${studentId}ã€‚å­¦å·åº”ä¸º1-51ä¹‹é—´çš„æ•°å­—ã€‚`);
                return;
            }
            
            const scoreCell = document.querySelector(`.score[data-id="${studentId}"]`);
            if (scoreCell) {
                scoreCell.classList.remove('permanent-highlight');
                permanentHighlights[studentId] = false;
                saveToLocalStorage();
                alert(`å·²ç§»é™¤ ${studentId} å·å­¦ç”Ÿçš„æ°¸ä¹…é«˜äº®`);
            }
        }
        
        function batchPermanentHighlight() {
            const input = document.getElementById('highlightStudents').value.trim();
            if (!input) return;
            
            const studentIds = input.split(',').map(id => parseInt(id.trim()));
            let successCount = 0;
            
            studentIds.forEach(studentId => {
                if (isNaN(studentId) || studentId < 1 || studentId > 51) return;
                
                const scoreCell = document.querySelector(`.score[data-id="${studentId}"]`);
                if (scoreCell) {
                    scoreCell.classList.add('permanent-highlight');
                    permanentHighlights[studentId] = true;
                    successCount++;
                }
            });
            
            alert(`æˆåŠŸä¸º ${successCount} åå­¦ç”Ÿè®¾ç½®æ°¸ä¹…é«˜äº®`);
            document.getElementById('highlightStudents').value = '';
            saveToLocalStorage();
        }
        
        function clearPermanentHighlights() {
            const scoreCells = document.querySelectorAll('.score');
            scoreCells.forEach(cell => {
                cell.classList.remove('permanent-highlight');
            });
            permanentHighlights = {};
            saveToLocalStorage();
            alert('å·²æ¸…é™¤æ‰€æœ‰æ°¸ä¹…é«˜äº®');
        }
        
        function batchAddScores() {
            const input = document.getElementById('batchScores').value.trim();
            if (!input) return;
            
            const entries = input.split(',');
            let successCount = 0;
            
            entries.forEach(entry => {
                const parts = entry.split(':');
                if (parts.length !== 2) return;
                
                const studentId = parseInt(parts[0].trim());
                const score = parseFloat(parts[1].trim());
                
                if (isNaN(studentId) || studentId < 1 || studentId > 51) return;
                if (isNaN(score) || score < 0 || score > 150) return;
                
                updateScore(studentId, score);
                if (isSpeechEnabled) {
                    const studentName = studentData[studentId].name;
                    addToSpeechQueue(`${studentName} ${score}åˆ†`);
                }
                successCount++;
            });
            
            alert(`æˆåŠŸæ·»åŠ  ${successCount} ä¸ªæˆç»©`);
            document.getElementById('batchScores').value = '';
            updateStats();
            updateChart();
            saveToLocalStorage();
        }
        
        function updateScore(studentId, score) {
            scores[studentId] = score;
            
            const scoreCell = document.querySelector(`.score[data-id="${studentId}"]`);
            if (scoreCell) {
                scoreCell.textContent = score % 1 === 0 ? score : score.toFixed(1);
                scoreCell.classList.remove('not-submitted');
                
                scoreCell.classList.remove('pass', 'fail');
                if (score >= passScore) {
                    scoreCell.classList.add('pass');
                } else {
                    scoreCell.classList.add('fail');
                }
                
                scoreCell.classList.add('highlight');
                setTimeout(() => {
                    scoreCell.classList.remove('highlight');
                }, 1000);
            }
        }
        
        function clearAllScores() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æˆç»©å¹¶é‡ç½®è€ƒè¯•åç§°å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                scores = {};
                examName = "æœªå‘½åè€ƒè¯•";
                permanentHighlights = {};
                
                document.getElementById('examNameDisplay').textContent = examName;
                
                const scoreCells = document.querySelectorAll('.score');
                scoreCells.forEach(cell => {
                    cell.textContent = '';
                    cell.classList.remove('pass', 'fail', 'not-submitted', 'permanent-highlight');
                });
                
                updateStats();
                updateChart();
                saveToLocalStorage();
                alert('æ‰€æœ‰æˆç»©å’Œè€ƒè¯•åç§°å·²æ¸…ç©ºï¼ç³»ç»Ÿå·²é‡ç½®ã€‚');
            }
        }
        
        function toggleRanking() {
            const rankingContainer = document.getElementById('rankingContainer');
            if (rankingContainer.style.display === 'none') {
                updateRanking();
                rankingContainer.style.display = 'block';
            } else {
                rankingContainer.style.display = 'none';
            }
        }
        
        function updateRanking() {
            const studentsWithScores = [];
            for (let i = 1; i <= 51; i++) {
                if (scores[i] !== undefined && scores[i] !== 'X' && !isNaN(parseFloat(scores[i]))) {
                    studentsWithScores.push({
                        id: i,
                        name: studentData[i].name,
                        score: parseFloat(scores[i])
                    });
                }
            }
            
            if (studentsWithScores.length === 0) {
                alert('æš‚æ— æˆç»©æ•°æ®ï¼Œæ— æ³•ç”Ÿæˆæ’è¡Œæ¦œ');
                return;
            }
            
            studentsWithScores.sort((a, b) => b.score - a.score);
            
            document.getElementById('rankingCount').textContent = studentsWithScores.length;
            document.getElementById('rankingExamName').textContent = examName;
            
            const rankingBody = document.getElementById('rankingBody');
            rankingBody.innerHTML = '';
            
            let currentRank = 1;
            let prevScore = null;
            let skipCount = 0;
            
            studentsWithScores.forEach((student, index) => {
                const row = document.createElement('tr');
                
                if (prevScore === null) {
                    currentRank = 1;
                } else if (student.score === prevScore) {
                    skipCount++;
                    row.classList.add('same-rank');
                } else {
                    currentRank += skipCount + 1;
                    skipCount = 0;
                }
                
                prevScore = student.score;
                
                const rankCell = document.createElement('td');
                rankCell.className = 'ranking-rank';
                
                if (currentRank === 1) {
                    rankCell.innerHTML = 'ğŸ¥‡ğŸ¥‡ ç¬¬1å';
                    rankCell.classList.add('medal-gold');
                } else if (currentRank === 2) {
                    rankCell.innerHTML = 'ğŸ¥ˆğŸ¥ˆ ç¬¬2å';
                    rankCell.classList.add('medal-silver');
                } else if (currentRank === 3) {
                    rankCell.innerHTML = 'ğŸ¥‰ğŸ¥‰ ç¬¬3å';
                    rankCell.classList.add('medal-bronze');
                } else {
                    rankCell.textContent = `ç¬¬${currentRank}å`;
                }
                
                const nameCell = document.createElement('td');
                nameCell.textContent = student.name;
                
                const idCell = document.createElement('td');
                idCell.textContent = student.id;
                
                const scoreCell = document.createElement('td');
                scoreCell.className = 'ranking-score';
                scoreCell.textContent = student.score % 1 === 0 ? student.score : student.score.toFixed(1);
                
                if (student.score >= passScore) {
                    scoreCell.classList.add('pass');
                } else {
                    scoreCell.classList.add('fail');
                }
                
                const statusCell = document.createElement('td');
                statusCell.textContent = student.score >= passScore ? 'åŠæ ¼' : 'ä¸åŠæ ¼';
                statusCell.style.color = student.score >= passScore ? '#4CAF50' : '#F44336';
                statusCell.style.fontWeight = 'bold';
                
                row.appendChild(rankCell);
                row.appendChild(nameCell);
                row.appendChild(idCell);
                row.appendChild(scoreCell);
                row.appendChild(statusCell);
                
                rankingBody.appendChild(row);
            });
        }
        
        function updateStats() {
            const scoreValues = Object.values(scores).filter(score => score !== 'X' && !isNaN(parseFloat(score)));
            
            if (scoreValues.length === 0) {
                document.getElementById('avgScore').textContent = '0';
                document.getElementById('maxScore').textContent = '0';
                document.getElementById('minScore').textContent = '0';
                document.getElementById('passRate').textContent = '0%';
                return;
            }
            
            const sum = scoreValues.reduce((a, b) => a + b, 0);
            const avg = sum / scoreValues.length;
            const max = Math.max(...scoreValues);
            const min = Math.min(...scoreValues);
            const passCount = scoreValues.filter(score => score >= passScore).length;
            const passRate = (passCount / scoreValues.length) * 100;
            
            document.getElementById('avgScore').textContent = avg.toFixed(1);
            document.getElementById('maxScore').textContent = max;
            document.getElementById('minScore').textContent = min;
document.getElementById('passRate').textContent = passRate.toFixed(1) + '%';
        }
        
        function updateChart() {
            const chart = document.getElementById('scoreChart');
            chart.innerHTML = '';
            
            const ranges = [
                { min: 0, max: 59, label: '0-59' },
                { min: 60, max: 69, label: '60-69' },
                { min: 70, max: 79, label: '70-79' },
                { min: 80, max: 89, label: '80-89' },
                { min: 90, max: 100, label: '90-100' }
            ];
            
            const scoreValues = Object.values(scores).filter(score => score !== 'X' && !isNaN(parseFloat(score)));
            const counts = ranges.map(range => {
                return scoreValues.filter(score => score >= range.min && score <= range.max).length;
            });
            
            const maxCount = Math.max(...counts);
            
            ranges.forEach((range, index) => {
                const count = counts[index];
                const height = maxCount > 0 ? (count / maxCount) * 100 : 0;
                
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = `${height}%`;
                bar.style.background = `hsl(${index * 60}, 70%, 50%)`;
                
                const valueLabel = document.createElement('div');
                valueLabel.className = 'chart-bar-value';
                valueLabel.textContent = count;
                
                const rangeLabel = document.createElement('div');
                rangeLabel.className = 'chart-bar-label';
                rangeLabel.textContent = range.label;
                
                bar.appendChild(valueLabel);
                bar.appendChild(rangeLabel);
                chart.appendChild(bar);
            });
        }
        
        function toggleStats() {
            const statsPanel = document.getElementById('statsPanel');
            statsPanel.style.display = statsPanel.style.display === 'none' ? 'grid' : 'none';
        }
        
        function toggleChart() {
            const chartContainer = document.getElementById('chartContainer');
            chartContainer.style.display = chartContainer.style.display === 'none' ? 'block' : 'none';
            if (chartContainer.style.display === 'block') {
                updateChart();
            }
        }
        
        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            document.body.classList.toggle('dark-theme');
            document.getElementById('themeToggle').textContent = isDarkTheme ? 'â˜€â˜€ äº®è‰²æ¨¡å¼' : 'ğŸŒ™ğŸŒ™ æš—è‰²æ¨¡å¼';
            saveToLocalStorage();
        }
        
        function exportData() {
            const data = {
                scores: scores,
                passScore: passScore,
                examName: examName,
                permanentHighlights: permanentHighlights,
                isSpeechEnabled: isSpeechEnabled,
                exportTime: new Date().toISOString()
            };
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${examName}æˆç»©æ•°æ®.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert(`"${examName}"æ•°æ®å¯¼å‡ºæˆåŠŸï¼`);
        }
        
        function showImportModal() {
            document.getElementById('importModal').style.display = 'flex';
        }
        
        function hideImportModal() {
            document.getElementById('importModal').style.display = 'none';
            document.getElementById('fileInput').value = '';
        }
        
        function importData() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('è¯·é€‰æ‹©è¦å¯¼å…¥çš„æ–‡ä»¶');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (typeof importedData !== 'object') {
                        throw new Error('æ— æ•ˆçš„æ•°æ®æ ¼å¼');
                    }
                    
                    scores = importedData.scores || {};
                    
                    if (importedData.passScore !== undefined) {
                        passScore = importedData.passScore;
                        document.getElementById('passScoreInput').value = passScore;
                        updatePassScoreDisplay();
                    }
                    
                    if (importedData.examName !== undefined) {
                        examName = importedData.examName;
                        document.getElementById('examNameDisplay').textContent = examName;
                    }
                    
                    if (importedData.permanentHighlights !== undefined) {
                        permanentHighlights = importedData.permanentHighlights;
                    }
                    
                    if (importedData.isSpeechEnabled !== undefined) {
                        isSpeechEnabled = importedData.isSpeechEnabled;
                        document.getElementById('toggleSpeech').textContent = isSpeechEnabled ? 'ğŸ”Š å…³é—­æœ—è¯»' : 'ğŸ”ˆ å¼€å¯æœ—è¯»';
                    }
                    
                    for (let i = 1; i <= 51; i++) {
                        const scoreCell = document.querySelector(`.score[data-id="${i}"]`);
                        if (scoreCell) {
                            const score = scores[i] || '';
                            scoreCell.textContent = score;
                            
                            scoreCell.classList.remove('pass', 'fail', 'not-submitted', 'permanent-highlight');
                            if (score === 'X') {
                                scoreCell.classList.add('not-submitted');
                            } else if (score !== '') {
                                const scoreValue = parseFloat(score);
                                if (!isNaN(scoreValue)) {
                                    scoreCell.classList.add(scoreValue >= passScore ? 'pass' : 'fail');
                                }
                            }
                            
                            if (permanentHighlights[i]) {
                                scoreCell.classList.add('permanent-highlight');
                            }
                        }
                    }
                    
                    updateStats();
                    updateChart();
                    saveToLocalStorage();
                    
                    alert('æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                    hideImportModal();
                } catch (error) {
                    alert('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®');
                }
            };
            
            reader.readAsText(file);
        }
        
        function showBackupNotice() {
            document.getElementById('backupNotice').style.display = 'block';
        }
        
        function getNextEmptyStudent() {
            for (let i = 1; i <= 51; i++) {
                if (scores[i] === undefined) {
                    return i;
                }
            }
            return 1;
        }
        
        function saveToLocalStorage() {
            const data = {
                scores: scores,
                isDarkTheme: isDarkTheme,
                passScore: passScore,
                examName: examName,
                permanentHighlights: permanentHighlights,
                isSpeechEnabled: isSpeechEnabled,
                lastUpdate: new Date().toISOString()
            };
            localStorage.setItem('class40Scores', JSON.stringify(data));
        }
        
        function loadFromLocalStorage() {
            const dataStr = localStorage.getItem('class40Scores');
            if (dataStr) {
                try {
                    const data = JSON.parse(dataStr);
                    scores = data.scores || {};
                    isDarkTheme = data.isDarkTheme || false;
                    passScore = data.passScore || 60;
                    examName = data.examName || "æœªå‘½åè€ƒè¯•";
                    permanentHighlights = data.permanentHighlights || {};
                    isSpeechEnabled = data.isSpeechEnabled !== undefined ? data.isSpeechEnabled : true;
                    
                    if (isDarkTheme) {
                        document.body.classList.add('dark-theme');
                        document.getElementById('themeToggle').textContent = 'â˜€â˜€ äº®è‰²æ¨¡å¼';
                    }
                    
                    document.getElementById('passScoreInput').value = passScore;
                    document.getElementById('examNameDisplay').textContent = examName;
                    document.getElementById('toggleSpeech').textContent = isSpeechEnabled ? 'ğŸ”ŠğŸ”Š å…³é—­æœ—è¯»' : 'ğŸ”ˆğŸ”ˆ å¼€å¯æœ—è¯»';
                    
                    for (let i = 1; i <= 51; i++) {
                        if (permanentHighlights[i]) {
                            const scoreCell = document.querySelector(`.score[data-id="${i}"]`);
                            if (scoreCell) {
                                scoreCell.classList.add('permanent-highlight');
                            }
                        }
                    }
                } catch (e) {
                    console.error('åŠ è½½æœ¬åœ°å­˜å‚¨æ•°æ®å¤±è´¥:', e);
                }
            }
        }
    </script>
</body>
</html>
